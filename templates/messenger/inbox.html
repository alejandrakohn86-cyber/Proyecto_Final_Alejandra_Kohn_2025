{% extends 'base.html' %}

{% block title %}Bandeja de Entrada{% endblock %}

{% block header %}📥 Mensajes Recibidos{% endblock %}

{% block content %}
<div style="margin-bottom: 20px;">
    <a href="{% url 'messenger:compose' %}" style="background-color: #3c8cf5; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; display: inline-block; margin-right: 10px;">✉️ Nuevo Mensaje</a>
    <a href="{% url 'messenger:sent' %}" style="background-color: #666; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; display: inline-block;">📤 Enviados</a>
    
    {% if no_leidos > 0 %}
        <span style="background-color: #e74c3c; color: white; padding: 5px 12px; border-radius: 20px; margin-left: 10px; font-size: 14px;">
            {{ no_leidos }} nuevo{% if no_leidos > 1 %}s{% endif %}
        </span>
    {% endif %}
</div>

{% if messages %}
    {% for message in messages %}
        <div style="padding: 10px; margin-bottom: 10px; background-color: #ddffdd; border-radius: 5px;">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

{% if mensajes %}
    {% for mensaje in mensajes %}
        <div style="border: 1px solid {% if not mensaje.leido %}#3c8cf5{% else %}#ddd{% endif %}; padding: 15px; margin-bottom: 15px; border-radius: 5px; {% if not mensaje.leido %}background-color: #f0f8ff;{% endif %}">
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <div style="flex: 1;">
                    {% if not mensaje.leido %}
                        <span style="background-color: #e74c3c; color: white; padding: 2px 8px; border-radius: 3px; font-size: 11px; margin-right: 8px;">NUEVO</span>
                    {% endif %}
                    <strong style="font-size: 16px;">{{ mensaje.asunto }}</strong>
                    <p style="margin: 5px 0; color: #666; font-size: 14px;">
                        De: <strong>{{ mensaje.remitente.get_full_name|default:mensaje.remitente.username }}</strong> | 
                        {{ mensaje.fecha_envio|date:"d/m/Y H:i" }}
                    </p>
                    <p style="margin: 10px 0; color: #333;">{{ mensaje.contenido|truncatewords:20 }}</p>
                </div>
                <div style="margin-left: 15px;">
                    <a href="{% url 'messenger:message-detail' mensaje.pk %}" style="background-color: #3c8cf5; color: white; padding: 8px 15px; text-decoration: none; border-radius: 5px; display: inline-block; margin-bottom: 5px;">Ver</a>
                    <a href="{% url 'messenger:message-delete' mensaje.pk %}" style="background-color: #e74c3c; color: white; padding: 8px 15px; text-decoration: none; border-radius: 5px; display: inline-block;">Borrar</a>
                </div>
            </div>
        </div>
    {% endfor %}
{% else %}
    <div style="text-align: center; padding: 40px; background-color: #f5f5f5; border-radius: 10px;">
        <h3>📭 No tienes mensajes</h3>
        <p>Tu bandeja de entrada está vacía.</p>
    </div>
{% endif %}
{% endblock %}
